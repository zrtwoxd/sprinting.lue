local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")

-- Set initial speed and enabled state
getgenv().Speed = 50  -- Your desired speed
getgenv().Enabled = false -- Start disabled

-- Bypass (only needs to be done once)
local function bypassWalkSpeed()
    if getgenv().bypassed then return end -- Prevent multiple bypasses
    getgenv().bypassed = true

    local mt = getrawmetatable(game)
    setreadonly(mt, false)
    local oldIndex = mt.__index
    mt.__index = newcclosure(function(self, k)
        if k == "WalkSpeed" then
            return 16 -- Return default speed to trick checks
        end
        return oldIndex(self, k)
    end)
end

bypassWalkSpeed()

-- Function to update walk speed
local function updateWalkSpeed()
    if Humanoid and Humanoid.WalkSpeed ~= getgenv().Speed and getgenv().Enabled then
        Humanoid.WalkSpeed = getgenv().Speed
    elseif Humanoid and not getgenv().Enabled and Humanoid.WalkSpeed ~= 16 then -- Reset to default
        Humanoid.WalkSpeed = 16
    end
end

-- Keybind
local ContextActionService = game:GetService("ContextActionService")
local function toggleSpeed(actionName, state, inputObject)
    if actionName == "ToggleWalkSpeed" and state == Enum.UserInputState.Begin then
        getgenv().Enabled = not getgenv().Enabled
        print("WalkSpeed " .. (getgenv().Enabled and "Enabled" or "Disabled"))
        updateWalkSpeed() -- Update immediately
    end
end
ContextActionService:BindAction("ToggleWalkSpeed", toggleSpeed, false, Enum.KeyCode.T)

-- Character added connection (for respawns)
LocalPlayer.CharacterAdded:Connect(function(char)
    Character = char
    Humanoid = char:WaitForChild("Humanoid")
    updateWalkSpeed() -- Update speed after respawn
end)

-- Main loop (only runs when enabled)
while task.wait() do
  if getgenv().Enabled then
    updateWalkSpeed()
  end
end
